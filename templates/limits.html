{% extends "base_dashboard.html" %}

{% block title %}Expense Limits - Expenzo{% endblock %}

{% block content %}
      <header class="dashboard-header">
        <h1>Expense Limits</h1>
      </header>

      <!-- Set/Update Limit Form -->
      <div class="limit-form-container">
        <div class="form-card">
          <h3>{% if limit %}Update{% else %}Set{% endif %} Expense Limit</h3>
          <form id="setLimitForm">
            <div class="form-group">
              <label>Limit Amount (₹)</label>
              <input type="number" name="limit" step="0.01" placeholder="0.00" min="0" 
                     value="{{ limit.limit if limit and limit.get('limit') else '' }}" required>
            </div>
            <div class="form-group">
              <label>Period</label>
              <select name="period" required>
                <option value="monthly" {% if limit and limit.get('period') == 'monthly' %}selected{% endif %}>Monthly</option>
                <option value="weekly" {% if limit and limit.get('period') == 'weekly' %}selected{% endif %}>Weekly</option>
                <option value="daily" {% if limit and limit.get('period') == 'daily' %}selected{% endif %}>Daily</option>
              </select>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn-primary">{% if limit %}Update{% else %}Set{% endif %} Limit</button>
              {% if limit %}
              <button type="button" class="btn-danger" id="deleteLimit">Delete Limit</button>
              {% endif %}
            </div>
          </form>
        </div>
      </div>

      <!-- Limit Status -->
      {% if limit and limit.get('limit') %}
      <div class="limit-status-container">
        <div class="limit-status-card">
          <div class="limit-header">
            <h3>Current Limit</h3>
            <span class="limit-period-badge">{{ limit.get('period', 'monthly').title() }}</span>
          </div>
          <div class="limit-amount-display">
            ₹{{ "%.2f"|format(limit.get('limit', 0)) }}
          </div>
          <div class="limit-progress">
            <div class="progress-bar">
              <div class="progress-fill" id="limitProgress" style="width: 0%"></div>
            </div>
            <div class="progress-info">
              <span id="spentAmount">₹0.00</span>
              <span>of</span>
              <span>₹{{ "%.2f"|format(limit.get('limit', 0)) }}</span>
            </div>
          </div>
          <div class="limit-warning" id="limitWarning" style="display: none;">
            <i class='bx bx-error-circle'></i>
            <span>You're approaching your limit!</span>
          </div>
        </div>
      </div>
      {% else %}
      <div class="empty-limit-state">
        <i class='bx bx-bar-chart-alt-2'></i>
        <h3>No Limit Set</h3>
        <p>Set an expense limit to track your spending and stay within budget.</p>
      </div>
      {% endif %}

      <!-- Limit History/Stats -->
      <div class="limit-stats-container">
        <h3>Spending Statistics</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <i class='bx bx-calendar'></i>
            </div>
            <div class="stat-info">
              <div class="stat-label">This Month</div>
              <div class="stat-value" id="monthlySpent">₹0.00</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class='bx bx-calendar-week'></i>
            </div>
            <div class="stat-info">
              <div class="stat-label">This Week</div>
              <div class="stat-value" id="weeklySpent">₹0.00</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class='bx bx-calendar-day'></i>
            </div>
            <div class="stat-info">
              <div class="stat-label">Today</div>
              <div class="stat-value" id="dailySpent">₹0.00</div>
            </div>
          </div>
        </div>
      </div>
{% endblock %}

{% block extra_js %}
  <script>
    window.limitData = {% if limit and limit.get('limit') %}{{ limit|tojson }}{% else %}null{% endif %};
  </script>
{% endblock %}
