{% extends "base_dashboard.html" %}

{% block title %}Visualization - Expenzo{% endblock %}

{% block content %}
      <header class="dashboard-header">
        <h1>Financial Insights & Visualization</h1>
        <div class="header-actions">
          <select class="time-period-selector" id="timePeriod">
            <option value="all">All Time</option>
            <option value="month">This Month</option>
            <option value="week">This Week</option>
          </select>
        </div>
      </header>

      <!-- Summary Cards -->
      <div class="visualization-summary">
        <div class="summary-card-large">
          <div class="summary-icon-large income-icon">
            <i class='bx bx-trending-up'></i>
          </div>
          <div class="summary-content">
            <div class="summary-label">Total Income</div>
            <div class="summary-value-large">₹{{ "%.2f"|format(total_income) }}</div>
          </div>
        </div>
        <div class="summary-card-large">
          <div class="summary-icon-large expense-icon">
            <i class='bx bx-trending-down'></i>
          </div>
          <div class="summary-content">
            <div class="summary-label">Total Expenses</div>
            <div class="summary-value-large">₹{{ "%.2f"|format(total_expense) }}</div>
          </div>
        </div>
        <div class="summary-card-large">
          <div class="summary-icon-large balance-icon">
            <i class='bx bx-wallet'></i>
          </div>
          <div class="summary-content">
            <div class="summary-label">Net Balance</div>
            <div class="summary-value-large {% if (total_income - total_expense) < 0 %}negative{% else %}positive{% endif %}">
              ₹{{ "%.2f"|format(total_income - total_expense) }}
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Grid -->
      <div class="charts-grid">
        <!-- Income vs Expense Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3>Income vs Expense</h3>
          </div>
          <div class="chart-container">
            <canvas id="incomeExpenseChart"></canvas>
          </div>
        </div>

        <!-- Expense by Category Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3>Expense by Category</h3>
          </div>
          <div class="chart-container">
            <canvas id="categoryChart"></canvas>
          </div>
        </div>

        <!-- Income Sources Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3>Income Sources</h3>
          </div>
          <div class="chart-container">
            <canvas id="incomeSourcesChart"></canvas>
          </div>
        </div>

        <!-- Monthly Trend Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3>Monthly Trend</h3>
          </div>
          <div class="chart-container">
            <canvas id="monthlyTrendChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Category Breakdown Table -->
      <div class="breakdown-section">
        <h3>Expense Breakdown by Category</h3>
        <div class="breakdown-table">
          <table class="data-table">
            <thead>
              <tr>
                <th>Category</th>
                <th>Amount</th>
                <th>Percentage</th>
                <th>Visual</th>
              </tr>
            </thead>
            <tbody>
              {% set total_exp = total_expense if total_expense > 0 else 1 %}
              {% for category, amount in category_expenses.items() %}
              <tr>
                <td>
                  <div class="category-cell">
                    <span class="category-badge">{{ category }}</span>
                  </div>
                </td>
                <td class="amount-cell">₹{{ "%.2f"|format(amount) }}</td>
                <td>{{ "%.1f"|format((amount / total_exp) * 100) }}%</td>
                <td>
                  <div class="progress-bar-mini">
                    <div class="progress-fill-mini" style="width: {{ (amount / total_exp) * 100 }}%"></div>
                  </div>
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="4" class="empty-state">No expense data available</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
{% endblock %}

{% block extra_js %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="{{ url_for('static', filename='dashboard.js') }}"></script>
  <script>
    window.visualizationData = {
      totalIncome: {{ total_income }},
      totalExpense: {{ total_expense }},
      categoryExpenses: {{ category_expenses|tojson }},
      incomeSources: {{ income_sources|tojson }},
      transactions: {{ transactions|tojson }}
    };
  </script>
{% endblock %}
