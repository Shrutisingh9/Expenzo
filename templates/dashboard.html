<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Dashboard - Expenzo</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script defer src="{{ url_for('static', filename='dashboard.js') }}"></script>
</head>
<body>
  {% include 'partials/navbar.html' %}
  <div class="app-grid">
    <aside class="sidebar">
      <!-- compact sidebar icons / links -->
      <div class="brand">Expenzo</div>
      <nav>
        <a href="{{ url_for('dashboard') }}">Dashboard</a>
        <a href="{{ url_for('cards_page') }}">Cards</a>
        <a href="{{ url_for('income_page') }}">Income</a>
        <a href="{{ url_for('expense_page') }}">Expense</a>
        <a href="{{ url_for('transactions_page') }}">Transactions</a>
        <a href="{{ url_for('limits_page') }}">Limits</a>
        <a href="{{ url_for('subscriptions_page') }}">Subscriptions</a>
        <a href="{{ url_for('features') }}">Visualization</a>
      </nav>
    </aside>

    <main class="main-content">
      <header class="topbar">
        <h1>Dashboard</h1>
        <div class="topbar-right">
          <div class="balance">Balance: ₹{{ balance }}</div>
        </div>
      </header>

      <section class="card-grid">
        <article class="card card-balance">
          <h3>Total Balance</h3>
          <p class="big">₹{{ balance }}</p>
          <div class="mini-graph" id="miniBalanceChart"></div>
        </article>

        <article class="card card-spending">
          <h3>Top Spending</h3>
          <div id="topSpendingChart"></div>
          <ul>
            <!-- small list of categories -->
          </ul>
        </article>

        <article class="card card-cards">
          <h3>Your Cards</h3>
          <div class="cards-list">
            {% for c in cards %}
              <div class="mini-card">
                <div class="brand">{{ c.brand or 'Card' }}</div>
                <div class="number">**** **** **** {{ c.number[-4:] if c.number else '----' }}</div>
              </div>
            {% else %}
              <p>No cards added</p>
            {% endfor %}
          </div>
          <a class="small-btn" href="{{ url_for('cards_page') }}">Manage Cards</a>
        </article>

        <article class="card card-transactions">
          <h3>Recent Transactions</h3>
          <ul class="recent-transactions">
            {% for t in recent_transactions %}
              <li>
                <div class="t-left">
                  <div class="t-title">{{ t.get('category') or t.get('source') or t.get('payee') }}</div>
                  <div class="t-date">{{ t.get('date') }}</div>
                </div>
                <div class="t-right">
                  <div class="t-amount {% if t.type == 'expense' %}neg{% endif %}">₹{{ t.amount }}</div>
                </div>
              </li>
            {% else %}
              <li>No recent transactions</li>
            {% endfor %}
          </ul>
          <a class="small-btn" href="{{ url_for('transactions_page') }}">View All</a>
        </article>

        <article class="card card-subscriptions">
          <h3>Upcoming Subscriptions</h3>
          <ul>
            {% for s in subscriptions %}
              <li>{{ s.name }} — ₹{{ s.amount }} (next: {{ s.next_payment_date }})</li>
            {% else %}
              <li>No active subscriptions</li>
            {% endfor %}
          </ul>
          <a class="small-btn" href="{{ url_for('subscriptions_page') }}">Manage</a>
        </article>
      </section>
    </main>
  </div>
</body>
</html>
